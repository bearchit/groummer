<script>
	function sign_up(){
		var nickname = $('#sign_up_nickname').val();
		var fullname = $('#sign_up_fullname').val();
		var pwd = $('#sign_up_pwd').val();
		var pwd_confirm = $('#sign_up_pwd_confirm').val();
		if ( pwd != pwd_confirm ){
			alert('비밀번호와 비밀번호 확인이 서로 맞지 않습니다');
		}else{
			$.ajax({
	            url: "/users/sign_up",
	            type: 'POST',
	            data: 'nickname='+ nickname + '&fullname=' + fullname + '&pwd=' + pwd,
	            error: function(){
	                return false;
	            },
	            success: function(data){
	            	$('#sign_form').html(data);
	            }
	       	});	
		}
	}
	
	function sign_up_form(){
		var form = '<div style="padding-right:60px;"><h2 style="text-align:left;">회원가입</h2><p>닉네임(아이디) <input type="text" style="width:180px;" id="sign_up_nickname" /></p><p>실제이름 <input type="text" style="width:180px;" id="sign_up_fullname" /></p><p>비밀번호 <input type="password" style="width:180px;" id="sign_up_pwd" /></p><p>비밀번호 확인 <input type="password" style="width:180px;" id="sign_up_pwd_confirm" /></p><div style="margin-bottom:10px;"><a href="/" class="btn" style="margin-right:30px;">로그인</a><a href="#" onclick="sign_up(); return false;" class="btn btn-primary">가입하기</a></div></div>';
		$('#sign_form').html(form);
	}
	
</script>

#{extends 'main.html' /}
<div class="row">
	<div style="display:inline-block; border-bottom: 1px solid #c5c5c5;">
		<div class="span8">
			#{list items:users, as:'user'}
			<div style="display:inline-block; text-align:center; margin:5px; padding:5px 7px 5px 7px; border:1px solid #c5c5c5;">
				<img src="@{Users.userPhoto(user.id)}" style="width:50px;height:50px;" />
				<br />
				${user.nickname}
				#{if user.status}
				<br />
					( <span id="status_user_${user.id}">${user.status.status}</span> )
				#{/if}
				#{else}
				<br />
					( <span id="status_user_${user.id}">노감정</span> )	
				#{/else}
			</div>
			#{/list}
			
		</div>
		<div class="span4" style="text-align:center;">
			<div id="sign_form" style=" border-left: 1px solid #c5c5c5; padding:0 0 10px 10px; text-align:right;">
				#{if current_user == null}
				 	#{include 'Secure/login.html' /}
				 #{/if}
				 #{else}
				 	#{include 'Secure/logon.html' /}
				 #{/else}
			</div>
		</div>
	</div>
</div>
<div class="row">
	<div style="display:inline-block; border-bottom: 1px solid #c5c5c5; margin:20px 0 20px 0;">
		<div class="span12">
			<div id="post" style="margin-right:30px;">
				#{if current_user}
				<table width="100%" style="margin-bottom:10px; text-align:center;">
					<tr>
						<td style="width:10%; border:1px solid #c5c5c5;">
							<img src="@{Users.userPhoto(current_user.id)}" style="width:50px;height:50px;" />
							<br />
							${current_user.nickname}
							#{if current_user.status}
							<br />
								( <span id="status_user_${current_user.id}">${current_user.status.status}</span> )
							#{/if}
							#{else}
							<br />
								( <span id="status_user_${current_user.id}">노감정</span> )	
							#{/else}
						</td>
						<td style="width:70%; border:1px solid #c5c5c5;">
							#{form @Application.post()}
						      <textarea name="content" id="content" style="width:90%; height:65px; margin-bottom:0;"></textarea>
						</td>
						<td style="width:10%; border:1px solid #c5c5c5;">
							<input type="submit" class="btn btn-primary" style="width:80%; height:50px; " value="등록" />
						    #{/form}
						</td>
					</tr>
				</table>
				#{/if}
				#{else}
				<table width="100%" style="margin-bottom:10px; text-align:center;">
					<tr>
						<td style="width:100%; height:50px; border:1px solid #c5c5c5;">
							쓰기는 로그인 후에 가능합니다.
						</td>
					</tr>
				</table>
				
				#{/else}
			</div>
		</div>
	</div>
</div>

<div class="row">
	<div style="display:inline-block; border-bottom: 1px solid #c5c5c5;">
		<div class="span12">
			sadf
		</div>
	</div>
</div>


	<div style="display:inline-block; border-bottom: 1px solid #c5c5c5;">
		<div class="span12">
			<h2>Timeline</h2>
			<div id="timeline">
			
			  <div id="post" style="width:100%; border-bottom: 1px solid #c5c5c5;">
			    #{form @Application.post()}
			    <p>
			      <label for="content">Your post: </label>
			      <textarea name="content" id="content"></textarea>
			    </p>
			    <p>
			      <input type="submit" value="Post" />
			    </p>
			    #{/form}
			  </div>
			  
			
			  <div id="post">
			    #{list items:posts, as:'post'}
			    <!-- Metadata -->
			    <div class="post-metadata">
			      <div>
			        <span class="post-author">${post.user.fullname}</span>
			        <span class="post-date">${post.createdAt}</span>
			      </div>
			    </div>
			
			    <!-- Contents -->
			    <div>
			      <span class="post-content">${post.content}</span>
			      <div class="post-actions">
			        <span class="reply"><a href="#" onclick="$('#post-reply_${post.id}').show();">Reply</a></span>
			
			        <div id="post-reply_${post.id}" style="display:none;">
			          #{form @Application.postComment(post.id)}
			          <p>
			            <label for="content">Replying to ${post.user.fullname}:</label>
			            <textarea name="content" id="content"></textarea>
			          </p>
			          <p>
			            <input type="submit" value="Reply" />
			          </p>
			          #{/form}
			        </div>
			
			      </div>
			      <span >
			    </div>
			
			    <!-- Comments -->
			    <div class="comments">
			      #{list items:post.comments, as:'comment'}
			      <div class="comment-metadata">
			        <span class="comment-author">${comment.user.fullname}</span>
			        <span class="comment-date">${comment.createdAt}</span>
			      </div>
			
			      <div class="comment-content">
			        ${comment.content.escape().nl2br()}</div>
			      #{/list}
			    </div>
			  </div>
			
			  #{/list}
			
			</div>
						
		
		
		</div>
	</div>
</div>
