<!DOCTYPE html>

<html>
  <head>
    <title>${appName}</title>
    <meta charset="${_response_encoding}">
    <link rel="stylesheet" media="screen"
          href="@{'/public/stylesheets/main.css'}">
    <link rel="stylesheet" media="screen"
          href="@{'/public/stylesheets/bootstrap.css'}">
    <link rel="stylesheet" media="screen"
          href="@{'/public/stylesheets/bootstrap-responsive.css'}">
    #{get 'moreStyles' /}
    <link rel="shortcut icon" type="image/png"
          href="@{'/public/images/favicon.png'}">

    <script src="@{'/public/javascripts/jquery-1.7.2.min.js'}"
            type="text/javascript" charset="${_response_encoding}"></script>
    #{get 'moreScripts' /}

    <script language="javascript">
      $(document).ready(function() {
      $('.dropdown-toggle').dropdown();
      });
    </script>

  </head>
  <body>
    <div id="flash" class="flash_html" style="display:none;" >
      #{if flash.message}
      ${flash.message}
      #{/if}
    </div>
    
    <!-- Navigation -->
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">

          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>

          <a class="brand" href="/">${appName}</a>
          <ul class="nav pull-right">
            #{if current_user}
            <li class="dropdown" id="user-menu">
              <a href="#user-menu" class="dropdown-toggle" data-toggle="dropdown">
                <img src="@{Users.userPhoto(current_user.id)}" style="width:30px;height:30px;" />
                ${current_user.nickname}
                <b class="caret"></b>
              </a>

              <!-- User info -->
              <ul class="dropdown-menu">
                <table  style="width:100%;">
                  <tr >
                    <td colspan="2" style="text-align:center">
                      <div id="profile-image">
                        <a href="#"><img src="@{Users.userPhoto(current_user.id)}" style="width:80px;height:80px;" onclick="javascript:document.getElementById('user_profileImage').click(); return false;" /></a>
                      </div>
                      <span>${current_user.status.status}</span>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      #{form @Users.profileImage_upload(), enctype:'multipart/form-data'}
                      <input type="file" id="user_profileImage" name="profileImage" style="visibility:hidden;position:absolute;top:0;left:0" onchange="javascript:alert('hello');document.forms[0].submit();">
                      #{/form}
                    </td>
                  </tr>
                </table>

                <li><a href="/logout">Logout</a></li>

              </ul>
            </li>
            #{/if}

            #{else}
            <li class="dropdown" id="signin-menu">
              <a href="#signin-menu" class="dropdown-toggle" data-toggle="dropdown">
                Sign in
                <b class="caret"></b>
              </a>

              <ul class="dropdown-menu">
                #{include 'Secure/signin.html' /}
              </ul>

            </li>

            #{/else}
          </ul>

        </div>
      </div>
    </div>

    <!-- Content -->
    <div class="container">
      #{doLayout /}
    </div>
    
    <script type="text/javascript">
      function notify(flash_message){
      // jQuery: reference div, load in message, and fade in
      var flash_div = $(".flash_html");
      flash_div.html(flash_message);
      flash_div.attr('class', 'flash_ajax');
      flash_div.fadeIn("fast");
      
      // use Javascript timeout function to delay calling
      // our jQuery fadeOut, and hide
      setTimeout(function(){
      flash_div.fadeOut("fast", function(){
      flash_div.html("");
      flash_div.attr('class', 'flash_html');
      flash_div.hide();
      })
      }, 2000);
      }
      var flash_message = $.trim($(".flash_html").html());
      // call our flash display function
      if (flash_message != "") {
      notify(flash_message);
      }
    </script>

    <!-- Lazy script loading -->
    <script src="@{'/public/javascripts/bootstrap.js'}"
            type="text/javascript" charset="${_response_encoding}"></script>
    <script src="@{'/public/javascripts/bootstrap-alert.js'}"
            type="text/javascript" charset="${_response_encoding}"></script>
    <script src="@{'/public/javascripts/bootstrap-dropdown.js'}"
            type="text/javascript" charset="${_response_encoding}"></script>

  </body>
</html>
